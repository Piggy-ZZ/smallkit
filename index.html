<script type="module">
    // 引入 Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"; 
    import { getDatabase, ref, get, set, onValue } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js"; 

    // Firebase 配置
    const firebaseConfig = {
        apiKey: "AIzaSyCPKjaddCIeCecc49SR9srs5ijjbMMx1JI",
        authDomain: "people-counting-1cae9.firebaseapp.com",
        projectId: "people-counting-1cae9",
        storageBucket: "people-counting-1cae9.appspot.com",
        messagingSenderId: "521847124489",
        appId: "1:521847124489:web:bd17765a151b60ccd97ed8",
        databaseURL: "https://people-counting-1cae9-default-rtdb.firebaseio.com"
    };

    // 初始化 Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 將 increment 函數暴露到全局範圍
    window.increment = function (type) {
        const countRef = ref(db, 'counts/' + type); 
        get(countRef).then((snapshot) => {
            let count = snapshot.val() || 0;
            count++;
            set(countRef, count);
        });
    };

    // 實時監聽數據變化
    onValue(ref(db, 'counts'), (snapshot) => {
        const data = snapshot.val();
        document.getElementById('countA').textContent = data.guestA || 0;
        document.getElementById('countB').textContent = data.guestB || 0;
        document.getElementById('countC').textContent = data.guestC || 0;
        document.getElementById('countD').textContent = data.guestD || 0;
        document.getElementById('countE').textContent = data.guestE || 0;
        document.getElementById('countF').textContent = data.guestF || 0;
        document.getElementById('countG').textContent = data.guestG || 0;
    });

    // 將 exportData 函數暴露到全局範圍
    window.exportData = function () {
        get(ref(db, 'counts')).then((snapshot) => {
            const counts = snapshot.val();
            let csvContent = "data:text/csv;charset=utf-8,"
                + "訪客類型,人數\n"
                + "A," + (counts.guestA || 0) + "\n"
                + "B," + (counts.guestB || 0) + "\n"
                + "C," + (counts.guestC || 0) + "\n"
                + "D," + (counts.guestD || 0) + "\n"
                + "E," + (counts.guestE || 0) + "\n"
                + "F," + (counts.guestF || 0) + "\n"
                + "G," + (counts.guestG || 0) + "\n";

            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "visitor_count.csv");
            document.body.appendChild(link);
            link.click();
        });
    };
</script>
